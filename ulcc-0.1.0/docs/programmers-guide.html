<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:ËÎÌå;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Mangal;
	panose-1:2 4 5 3 5 2 3 3 2 2;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Liberation Sans";}
@font-face
	{font-family:"DejaVu Sans";}
@font-face
	{font-family:"Liberation Serif";}
@font-face
	{font-family:"\@ËÎÌå";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"\@Liberation Serif";}
@font-face
	{font-family:"\@Liberation Sans";}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.3in;
	text-indent:-.3in;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Liberation Sans","sans-serif";}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.4in;
	text-indent:-.4in;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	font-style:italic;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.5in;
	text-indent:-.5in;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria","serif";}
h4
	{mso-style-link:"Heading 4 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.6in;
	text-indent:-.6in;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Calibri","sans-serif";}
h5
	{mso-style-link:"Heading 5 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.7in;
	text-indent:-.7in;
	font-size:13.0pt;
	font-family:"Calibri","sans-serif";
	font-style:italic;}
h6
	{mso-style-link:"Heading 6 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.8in;
	text-indent:-.8in;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{mso-style-link:"Heading 7 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.9in;
	text-indent:-.9in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{mso-style-link:"Heading 8 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:1.0in;
	text-indent:-1.0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-style:italic;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{mso-style-link:"Heading 9 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:1.1in;
	text-indent:-1.1in;
	font-size:11.0pt;
	font-family:"Cambria","serif";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{mso-style-link:"Body Text Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Liberation Serif","serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{mso-style-link:"No Spacing Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
span.NoSpacingChar
	{mso-style-name:"No Spacing Char";
	mso-style-link:"No Spacing";}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Liberation Sans","sans-serif";
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	font-weight:bold;
	font-style:italic;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	font-weight:bold;}
span.Heading4Char
	{mso-style-name:"Heading 4 Char";
	mso-style-link:"Heading 4";
	font-family:"Mangal","serif";
	font-weight:bold;}
span.Heading5Char
	{mso-style-name:"Heading 5 Char";
	mso-style-link:"Heading 5";
	font-family:"Mangal","serif";
	font-weight:bold;
	font-style:italic;}
span.Heading6Char
	{mso-style-name:"Heading 6 Char";
	mso-style-link:"Heading 6";
	font-family:"Mangal","serif";
	font-weight:bold;}
span.Heading7Char
	{mso-style-name:"Heading 7 Char";
	mso-style-link:"Heading 7";
	font-family:"Mangal","serif";}
span.Heading8Char
	{mso-style-name:"Heading 8 Char";
	mso-style-link:"Heading 8";
	font-family:"Mangal","serif";
	font-style:italic;}
span.Heading9Char
	{mso-style-name:"Heading 9 Char";
	mso-style-link:"Heading 9";
	font-family:"Cambria","serif";}
span.BodyTextChar
	{mso-style-name:"Body Text Char";
	mso-style-link:"Body Text";
	font-family:"Liberation Serif","serif";}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple>

<div class=WordSection1>

<div align=center>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width="100%"
 style='width:100.0%;border-collapse:collapse'>
 <tr style='height:2.0in'>
  <td width="100%" valign=top style='width:100.0%;padding:0in 5.4pt 0in 5.4pt;
  height:2.0in'>
  <p class=MsoNoSpacing align=center style='text-align:center'><span
  style='font-family:"Times New Roman","serif";text-transform:uppercase'>High
  performance computing and software laboratory</span></p>
  <p class=MsoNoSpacing align=center style='text-align:center'><span
  style='font-family:"Times New Roman","serif";text-transform:uppercase'>the
  ohio state university</span></p>
  </td>
 </tr>
 <tr style='height:4.0pt'>
  <td width="100%" style='width:100.0%;border:none;border-bottom:solid #4F81BD 1.0pt;
  padding:0in 5.4pt 0in 5.4pt;height:4.0pt'>
  <p class=MsoNoSpacing align=center style='text-align:center'><span
  style='font-size:40.0pt;font-family:"Times New Roman","serif"'>ULCC
  Programmer¡¯s Guide v0.1.0</span></p>
  </td>
 </tr>
 <tr style='height:.5in'>
  <td width="100%" style='width:100.0%;border:none;padding:0in 5.4pt 0in 5.4pt;
  height:.5in'>
  <p class=MsoNoSpacing align=center style='text-align:center'><span
  style='font-size:22.0pt;font-family:"Times New Roman","serif"'>&nbsp;</span></p>
  </td>
 </tr>
 <tr style='height:.25in'>
  <td width="100%" style='width:100.0%;padding:0in 5.4pt 0in 5.4pt;height:.25in'>
  <p class=MsoNoSpacing align=center style='text-align:center'><span
  style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>
  </td>
 </tr>
 <tr style='height:.25in'>
  <td width="100%" style='width:100.0%;padding:0in 5.4pt 0in 5.4pt;height:.25in'>
  <p class=MsoNoSpacing align=center style='text-align:center'><b><span
  style='font-size:12.0pt;font-family:"Times New Roman","serif"'>&nbsp;</span></b></p>
  </td>
 </tr>
 <tr style='height:.25in'>
  <td width="100%" style='width:100.0%;padding:0in 5.4pt 0in 5.4pt;height:.25in'>
  <p class=MsoNoSpacing align=center style='text-align:center'><span
  style='font-size:12.0pt;font-family:"Times New Roman","serif"'>February 13,
  2011</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 align=left
 width="100%" style='width:100.0%;border-collapse:collapse;margin-left:7.1pt;
 margin-right:7.1pt'>
 <tr>
  <td width="100%" valign=top style='width:100.0%;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNoSpacing><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<b><span style='font-size:16.0pt;font-family:"Times New Roman","serif"'><br
clear=all style='page-break-before:always'>
</span></b>

<h1 style='text-align:justify;text-justify:inter-ideograph'><a
name="_Toc284620649"><span style='font-family:"Times New Roman","serif"'>1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:"Times New Roman","serif"'>Concepts</span></a></h1>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>We
use the term <i>cache</i> to specifically refer to the <i>last level cache</i>
shared by a set of CPU¡¯s. The definition of a <i>CPU</i> is the same as its
definition in Linux system interface, </span><a
href="http://linux.die.net/man/2/sched_setaffinity"><i><span style='font-family:
"Times New Roman","serif"'>sched_setaffinity</span></i></a><span
style='font-family:"Times New Roman","serif"'>. As a matter of fact, in the
current implementation of ULCC, the <i>cc_cpuset_t</i> data structure is
directly defined as </span><a href="http://linux.die.net/man/3/cpu_set"><i><span
style='font-family:"Times New Roman","serif";color:windowtext'>cpu_set_t</span></i></a><span
style='font-family:"Times New Roman","serif"'>, and therefore the successful
compilation of ULCC source code depends on the availability of <i>libcpuset</i>
library in the system (which is true on most Linux systems). On systems where <i>libcpuset</i>
is not available, the user may change the definition of <i>cc_cpuset_t</i> and
associated interfaces to use, for example, an integer array or a bit mask to
represent a CPU set.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>There are five key concepts,
corresponding to five data structures, in ULCC: <i>data set</i>, <i>thread set</i>,
<i>CPU set</i>, <i>cache slot</i> and <i>cache region</i>. A <i>data set</i>
defines a set of data to be accessed by user program in its virtual space; a <i>thread
set</i> or a <i>CPU set</i> is a set of threads or logical CPUs that will
access the data set; a <i>cache slot</i> specifies a slot of cache space
requested by user. Basically, a data set defines the data; a thread set or a
CPU set tells where the data will be used; a cache slot specifies how much
cache space for these data. The details of each data structure are explained
below.</span></p>

<h2 style='text-align:justify;text-justify:inter-ideograph'><a
name="_Toc284620650"><span style='font-family:"Times New Roman","serif"'>1.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>Data set</span></a></h2>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>typedef struct cc_dataset_s</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>{</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *d_start;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *d_end;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d_max;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d_count;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>} cc_dataset_t;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>There are four memory variables
in a <i>cc_dataset_t</i> structure (<i>cc</i> stands for <i>cache control</i>,
which is the prefix for the names of all ULCC interfaces and data structures).
A data set can hold a maximum of <i>d_max</i> virtual memory regions. The
current number of virtual memory regions in this data set is <i>d_count</i>,
and the <i>i</i>th virtual memory region is specified as [<i>d_start</i>[<i>i</i>],
<i>d_end</i>[<i>i</i>]). Since ULCC can only change physical page mappings in a
granularity of pages, only the part of whole pages in a virtual memory region
will be considered in the cache space allocation phase. This should not impair
the effectiveness of cache control, because the preceding and trailing sub-page
parts are usually neglectable relative to the main pages in the middle of a
memory region.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>ULCC provides some utility
functions to manipulate a data set, whose definitions can be found in
src/util.h.</span></p>

<h2><a name="_Toc284620651"><span style='font-family:"Times New Roman","serif"'>1.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>Thread set</span></a></h2>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>typedef pthread_t cc_tid_t;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>typedef struct cc_thrdset_s</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>{</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; cc_tid_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *t_threads;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; t_max;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t_count;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>} cc_thrdset_t;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>A <i>cc_thrdset_t</i> structure
contains a set of thread ids, <i>t_threads</i>. In the current implementation,
the type of thread id, <i>cc_tid_t</i>, is the same as POSIX Threads <i>pthread_t</i>.
A thread set contains a maximum of <i>t_max</i> thread ids, and the current
number of ids held is <i>t_count</i>.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>ULCC provides a set of utility
functions to operate on a thread set, which are defined in src/util.h.</span></p>

<h2><a name="_Toc284620652"><span style='font-family:"Times New Roman","serif"'>1.3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>CPU set</span></a></h2>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>typedef cpu_set_t cc_cpuset_t;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><a
href="http://www.gnu.org/s/libc/manual/html_node/CPU-Affinity.html"><i><span
style='font-family:"Times New Roman","serif"'>cpu_set_t</span></i></a><span
style='font-family:"Times New Roman","serif"'>, which is a GNU extension to C
library, is used as the CPU set type in current ULCC implementation. The user
should use the macros provided in GNU C to specify the set of CPU¡¯s from where
the data set will be accessed.</span></p>

<h2><a name="_Toc284620653"><span style='font-family:"Times New Roman","serif"'>1.4<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>Cache slot</span></a></h2>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>typedef struct cc_cacheslot_s</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>{</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s_size;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:35.45pt;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s_type;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>} cc_cacheslot_t;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>A cache slot defines two
parameters: <i>s_size</i> is the size (in bytes) of the cache space required; <i>s_type</i>
is the type of the cache space required. ULCC interprets a cache slot and
allocates a cache space that is at least <i>s_size</i> bytes large and is of <i>s_type</i>
type. <i>s_type</i> can have the value of <i>CC_PRIVATE</i> or <i>CC_SHARED</i>.
<i>CC_PRIVATE</i> means the allocated cache space has to be <i>private</i>, comprised
of cache colors that haven¡¯t be reserved by any other allocation; <i>CC_SHARED</i>
means the cache space can share and meanwhile be shared by other shared cache
spaces. Private cache spaces are usually allocated to hold strong locality data
sets, while shared cache spaces are often used for weak locality data sets.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>As we know, a cache can be
divided into many regions according to page colors. Instead of directly specifying
cache colors, ULCC provides an abstraction, <i>cache slot</i>, to let users
specify the cache space to be allocated. Separating user programs from
low-level cache colors provides at least two benefits: (1) using a cache slot
to specify a cache space requirement increases a program¡¯s portability across
machines with different cache configurations; (2) ULCC has more opportunities
to optimize cache space allocation if no fixed cache colors are specified.
Interested users may refer to the </span><a
href="http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-1.pdf"><span
style='font-family:"Times New Roman","serif"'>paper</span></a><span
style='font-family:"Times New Roman","serif"'> and the source codes (in <i>cache.c</i>)
for details of this idea.</span></p>

<h2><a name="_Toc284620654"><span style='font-family:"Times New Roman","serif"'>1.5<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>Cache region</span></a></h2>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt'><span style='font-family:"Courier New"'>typedef
struct cc_cacheregn_s</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Courier New"'>{</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt'><span style='font-family:"Courier New"'> unsigned
char color_map[ULCC_NUM_CACHE_COLORS / 8];</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.4in;margin-bottom:.0001pt'><span style='font-family:"Courier New"'>}
cc_cacheregn_t;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>A cache region structure is a bit
mask representation of a set of cache colors. This is a low-level data
structure to specify a cache space. The total number of cache colors can be
queried through ULCC utility function <i>cc_cache_colors()</i>, then the
available cache colors range from <i>0</i> to (<i>cc_cache_colors() ¨C 1)</i>.
Users should always use ULCC utility functions to manipulate a cache region
structure (see src/util.h ).</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>Even though the cache slot
structure provides benefits of hiding low-level cache colors from user
programs, there are times when users want to directly control the allocation of
cache colors. Suppose the system only runs one ULCC application written by the
programmer (which is a common case in high-performance computing scenario),
then directly specifying which cache colors should be allocated for which data
sets is usually more efficient. Therefore, in real world application, we
suggest experienced programmers with full control over the system use <i>cc_cacheregn_t</i>
and the low-level function <i>cc_remap()</i> to do cache space allocation (see
src/remapper.h).</span></p>

<h1 style='text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:"Times New Roman","serif"'>ULCC programming
by examples</span></h1>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>In
this section, we introduce how to write cache-friendly programs using ULCC. For
the sake of simplicity, we use two contrived examples to demonstrate the main ideas.
However, the principles and approaches are the same when optimizing real-world applications.
The first example program shows how to improve the performance of a loop that repeatedly
scans through an array whose size is larger than the cache size. This example demonstrates
that more optimization opportunities can be exposed to programmers by ULCC, not
only on multi-core processors but also on traditional single-cores. The second
example uses ULCC to improve the performance of a strong-locality loop thread
co-running with a weak-locality loop thread. This example shows how to use ULCC
to partition cache space among data sets with different locality strengths,
thus to improve the performance of accessing both kinds of data sets.</span></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0in;margin-bottom:0in;
margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>The experimental system used by
the authors to run the programs in this tutorial is a machine with an Intel
Core i5 processor that has a 3-MiB last level cache shared by two CPU cores.
Each CPU core supports two simultaneous threads in hardware. The memory size is
4GB. Linux OS with 2.6.35 version kernel is installed on the machine. GCC 4.3</span></p>

<h2><span style='font-family:"Times New Roman","serif"'>2.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>Improving the performance
of a `weak-locality¡¯ loop</span></h2>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>In
this example, a program repeatedly scans an array of objects whose total size
is larger than the cache size, as is shown in Figure 1. Suppose LRU replacement
algorithm is used in the hardware cache. Since the array is too large to fit
into the cache, accessing data in the tail of the array will evict data in the
head of the array from the cache. Thus, the program will suffer a lot of cache
misses in each loop and the performance of the program is impaired.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>If MRU replacement algorithm in used
the hardware cache, then we won¡¯t have such problem. However, programmers have
no control over the hardware cache replacement algorithm, and a MRU algorithm
may introduce new problems for other programs. Now we show how to optimize the
performance of this program with ULCC library. The approach we take can be
summarized as follows:</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-.25in'><span style='font-family:"Times New Roman","serif"'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:"Times New Roman","serif"'>Partition the cache space into
two regions: one large region for data that we decide to keep in the cache
across different loops, and one small region for the rest of the array data;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.25in'><span style='font-family:"Times New Roman","serif"'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:"Times New Roman","serif"'>Using ULCC, we map part of the
data in the array to use the large cache region, and we map all the rest data to
use the small cache region.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'><img border=0 width=323
height=256 src="programmers-guide_files/image001.png"></span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>Figure
1. A program that repeatedly scans an array of objects in a loop.</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'><img border=0 width=321
height=246 src="programmers-guide_files/image002.png"></span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>Figure
2. Improve the performance by mapping part of the array to a large cache region
and mapping the rest of the array to a small cache region.</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>As illustrated in Figure 2, after
using ULCC to partition the cache space and map data into the cache accordingly,
LLC misses can be restricted to a small cache region and the data loaded into
the large cache region can be kept across different loops. Thus, the total
number of cache misses can be reduced and the performance will be improved.</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>The source code of this example
is given in the <i>test1()</i> routine in the <i>test/test.c</i> file. You
should change the parameters of the program to fit the cache size of your own
machine before running the program. Here are the extracted main code:</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cc_aid_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aid_strong,
aid_weak;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cc_cacheslot_t&nbsp;&nbsp;&nbsp; cs;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>¡­ ¡­</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-size:10.0pt;font-family:"Courier New"'>/* Allocate a private cache
space for part of the large data, such that this part of data can be kept in
LLC across different loops, w/o incurring extra misses. */</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_type = CC_PRIVATE;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_size = 4096 * 680; /* cache size
slightly bigger than data size 4096 * 640 */</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>aid_strong = cc_alloc2((unsigned long)start,</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>(unsigned
long)(start + 4096 * 640), NULL, &amp;cs, 0);</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-size:10.0pt;font-family:
"Courier New"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-size:10.0pt;font-family:"Courier New"'>/* We don't have enough
cache space to hold the rest of the large data, so we squeeze them into a small
shared cache space, which is separated from the previously allocated private
space. */</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_type = CC_SHARED;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_size = 4096 * 60;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>aid_weak = cc_alloc2_cpus((unsigned
long)(start + 4096 * 640),</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>(unsigned
long)(end), NULL, &amp;cs, 0);</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-size:10.0pt;font-family:
"Courier New"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>/* Do the computation: scan the array repeatedly
*/</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>for(i = 0; i &lt; 10000; i++)</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>{</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>for(p
= start; p &lt; end; p += 64)</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>{</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:1.0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>c =
*p;</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>}</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>}</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-size:10.0pt;font-family:
"Courier New"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>/* Deallocate */</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cc_dealloc(aid_strong);</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-size:10.0pt;font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cc_dealloc(aid_weak);</span></p>

<p class=MsoBodyText style='margin-top:6.0pt;margin-right:0in;margin-bottom:
0in;margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>On our machine, we measured the
time to do the computation without and with the help of ULCC. It was seen that
with the help of ULCC the execution time of the loop was reduced by over 30%.
The performance improvement is mainly due to the reduction of cache misses
after using ULCC to partially protect array data in the cache. This
optimization cannot be easily achieved without the help of ULCC.</span></p>

<h2><span style='font-family:"Times New Roman","serif"'>2.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>Improving the
performance of a </span><span style='font-family:"Times New Roman","serif"'>`</span><span
lang=X-NONE style='font-family:"Times New Roman","serif"'>strong-locality</span><span
style='font-family:"Times New Roman","serif"'>¡¯</span><span lang=X-NONE
style='font-family:"Times New Roman","serif"'> loop co-running with a </span><span
style='font-family:"Times New Roman","serif"'>`</span><span lang=X-NONE
style='font-family:"Times New Roman","serif"'>weak-locality</span><span
style='font-family:"Times New Roman","serif"'>¡¯</span><span style='font-family:
"Times New Roman","serif"'> </span><span style='font-family:"Times New Roman","serif"'>loop</span></h2>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>Having
shown how to use ULCC to optimize a single-thread program, we now use another
example to demonstrate how to reduce cache pollution when threads are
co-running on multiple cores sharing the same cache.</span></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0in;margin-bottom:0in;
margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>In this example, as shown in
Figure 3, two threads are co-running on two cores sharing the same cache. These
two threads all repeatedly scan arrays in a loop. The array scanned by the
first thread is small enough to fit into the cache, while the size of the array
scanned by the second thread is much larger than the cache size. Suppose we
want to hold the first array in the cache and prevent its data from being
evicted by the second thread. Since the second array is too large, we don¡¯t
care whether the performance of the second thread will be improved (as we will show
later, the execution time of the second thread will also be reduced as we
optimize the cache for the first thread).</span></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0in;margin-bottom:0in;
margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>The approach we take to optimize
this case is similar to the first one. We map the data in the first array to a
large-enough private cache region in the cache, and we map the data in the
large array to the rest of the cache space. In this way, accessing the large
array will only evict its own data in the cache, and the data of the small
array can be kept in the cache and reused across different loops. This is illustrated
in Figure 4.</span></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0in;margin-bottom:0in;
margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'><img border=0 width=359
height=288 src="programmers-guide_files/image003.png"></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>Figure
3. Two threads co-running on a dual-core processor; each thread scans an array
in a loop.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'><img
border=0 width=315 height=295 src="programmers-guide_files/image004.png"></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>Figure
4. Give the small array enough cache space, while restrict the cache usage of
the large array into a separate small cache region.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0in;margin-bottom:0in;
margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>The source code for this example
is given in the <i>test2()</i> procedure in <i>test/test.c</i> file. Some important
code snippets are extracted here:</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_type = CC_PRIVATE;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_size = size1 + cc_cache_size() /
cc_cache_colors() * 2;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>aid_data1 = cc_alloc2((unsigned
long)data1_start,</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>(unsigned
long)data1_end, NULL, &amp;cs,</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>CC_ALLOC_NOMOVE
| CC_MAPORDER_RAND);</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-size:10.0pt;font-family:
"Courier New"'>&nbsp;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_type = CC_SHARED;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>cs.s_size = cc_cache_size() /
cc_cache_colors() * 1;</span></p>

<p class=MsoBodyText style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph;text-indent:.5in'><span style='font-size:
10.0pt;font-family:"Courier New"'>aid_data2 = cc_alloc2((unsigned
long)data2_start,</span></p>

<p class=MsoBodyText style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph;
text-indent:.5in'><span style='font-size:10.0pt;font-family:"Courier New"'>(unsigned
long)data2_end, NULL, &amp;cs, 0);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;text-justify:inter-ideograph'><span style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0in;margin-bottom:0in;
margin-left:0in;margin-bottom:.0001pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-family:"Times New Roman","serif"'>We ran the program and compared
the execution times of the first thread and the second thread without and with
ULCC. It was found that after using ULCC, the execution time of the
strong-locality loop thread was reduced by almost 50% on average, and the
execution time of the weak-locality loop was also reduced by over 20%. The
performance improvement for the second thread is mainly because, after using
ULCC to make the first array held in the cache, fewer memory accesses are
generated by the first thread and the contention over memory controller and
memory bandwidth seen by the second thread is reduced.</span></p>

</div>
<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=6611859; 
var sc_invisible=1; 
var sc_security="e6c0edb4"; 
</script>

<script type="text/javascript"
src="http://www.statcounter.com/counter/counter.js"></script><noscript><div
class="statcounter"><a title="website tonight analytics"
href="http://statcounter.com/godaddy_website_tonight/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/6611859/0/e6c0edb4/1/"
alt="website tonight analytics" ></a></div></noscript>
<!-- End of StatCounter Code -->
</body>

</html>
